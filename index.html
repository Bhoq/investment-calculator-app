<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bushra Hoq — Investment Calculator</title>
  <style>
    :root{
      --bg:#0b1220;
      --text:#e9eefc;
      --muted:#a9b3cf;
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.14);
      --accent:#6aa7ff;
      --accent2:#79ffd7;
      --orange:#ff7a00;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --r:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(106,167,255,.22), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(121,255,215,.16), transparent 55%),
        radial-gradient(1200px 900px at 50% 100%, rgba(156,120,255,.12), transparent 60%),
        var(--bg);
      padding:24px;
    }
    .wrap{max-width:1180px;margin:0 auto}
    header{
      display:flex;gap:14px;align-items:flex-start;justify-content:space-between;
      margin-bottom:18px;
    }
    .title{display:flex;flex-direction:column;gap:4px}
    .name{margin:0;font-size:20px;letter-spacing:.2px;color:var(--orange);font-weight:900}
    .app{margin:0;font-size:18px;font-weight:800}
    .sub{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
    .badge{
      padding:6px 10px;border-radius:999px;
      background:linear-gradient(90deg, rgba(106,167,255,.18), rgba(121,255,215,.12));
      border:1px solid var(--border);
      color:var(--muted);
      font-size:12px;
      display:flex;gap:8px;align-items:center;
      white-space:nowrap;
      margin-top:2px;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;background:var(--accent);
      box-shadow:0 0 0 4px rgba(106,167,255,.14);
    }
    .grid{
      display:grid;
      grid-template-columns: 440px 1fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panel .hd{
      padding:14px 14px 12px 14px;
      display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.02);
    }
    .panel .hd .k{display:flex;flex-direction:column;gap:2px}
    .panel .hd .k .t{font-size:14px;font-weight:650}
    .panel .hd .k .d{font-size:12px;color:var(--muted)}
    .panel .bd{padding:14px}

    .form{display:grid;grid-template-columns: 1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field.full{grid-column:1 / -1}
    label{font-size:12px;color:var(--muted)}
    input, select{
      width:100%;
      padding:10px 11px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(10,16,30,.55);
      color:var(--text);
      outline:none;
      transition: border-color .15s ease, box-shadow .15s ease, transform .05s ease;
      font-size:13px;
    }
    input:focus, select:focus{
      border-color:rgba(106,167,255,.65);
      box-shadow:0 0 0 4px rgba(106,167,255,.16);
    }
    .hint{font-size:11px;color:rgba(169,179,207,.85);line-height:1.35}
    .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .btn{
      cursor:pointer;
      border-radius:12px;
      border:1px solid var(--border2);
      padding:10px 12px;
      font-weight:650;
      font-size:13px;
      color:var(--text);
      background:rgba(255,255,255,.04);
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .btn.primary{
      background:linear-gradient(90deg, rgba(106,167,255,.28), rgba(121,255,215,.18));
      border-color:rgba(106,167,255,.40);
    }
    .btn:hover{border-color:rgba(255,255,255,.22)}
    .btn.primary:hover{border-color:rgba(106,167,255,.60)}
    .btn:active{transform:translateY(0.5px)}
    .note{
      margin-left:auto;
      font-size:11px;color:var(--muted);
      display:flex;gap:8px;align-items:center;
    }
    .pill{
      font-family:var(--mono);
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03);
      color:rgba(233,238,252,.9);
      font-size:11px;
    }

    .kpis{display:grid;grid-template-columns: repeat(4, 1fr);gap:12px}
    @media (max-width: 980px){ .kpis{grid-template-columns: repeat(2, 1fr)} }
    .kpi{
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.02);
    }
    .kpi .l{font-size:11px;color:var(--muted)}
    .kpi .v{margin-top:6px;font-size:17px;font-weight:750;letter-spacing:.2px}
    .kpi .s{margin-top:4px;font-size:11px;color:rgba(169,179,207,.9)}

    .chartWrap{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.02);
    }
    .chartTop{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:10px}
    .legend{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:12px}
    .key{display:flex;gap:6px;align-items:center}
    .sw{width:10px;height:10px;border-radius:3px;background:var(--accent)}
    .sw.b{background:var(--accent2)}
    canvas{width:100%;height:250px;display:block}

    .tableWrap{
      margin-top:12px;
      border-radius:14px;
      border:1px solid var(--border);
      overflow:hidden;
      background:rgba(255,255,255,.02);
    }
    table{width:100%;border-collapse:collapse;font-size:12px}
    thead th{
      text-align:left;
      padding:10px 10px;
      color:var(--muted);
      font-weight:650;
      border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.02);
      position:sticky;top:0;
    }
    tbody td{
      padding:9px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      color:rgba(233,238,252,.95);
    }
    tbody tr:hover{background:rgba(255,255,255,.03)}
    .right{text-align:right}
    .small{font-size:11px;color:var(--muted)}
    .warn{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,106,106,.25);
      background:rgba(255,106,106,.08);
      color:rgba(255,220,220,.95);
      font-size:12px;
      display:none;
    }
    .footerHelp{margin-top:10px;color:rgba(169,179,207,.85);font-size:11px;line-height:1.35}

    /* PDF export = print */
    @media print{
      body{background:#fff !important; color:#000 !important; padding:14px}
      .badge, .actions, .note {display:none !important}
      .panel{box-shadow:none !important; border:1px solid #ccc !important; background:#fff !important}
      .sub, .small, label, .hint, .kpi .l, .kpi .s, .legend {color:#333 !important}
      .name{color:#ff7a00 !important}
      input, select {border:1px solid #ccc !important; background:#fff !important; color:#000 !important}
      canvas {display:none !important}
      .chartWrap::after{
        content:"(Chart hidden in print/PDF to keep export clean)";
        display:block; color:#555; font-size:12px; padding:10px 0 0 0;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1 class="name">Bushra Hoq</h1>
        <h2 class="app">Investment Calculator</h2>
        <p class="sub">Compound growth + contributions + inflation + taxes + target planning. Runs 100% locally in your browser.</p>
      </div>
      <div class="badge" title="No uploads. No tracking. Works offline.">
        <span class="dot"></span>
        <span>Standalone • Offline-ready</span>
      </div>
    </header>

    <div class="grid">
      <!-- INPUTS -->
      <section class="panel">
        <div class="hd">
          <div class="k">
            <div class="t">Inputs</div>
            <div class="d">Tune assumptions, then click “Calculate”.</div>
          </div>
          <div class="small">Shareable single file</div>
        </div>
        <div class="bd">
          <div class="form">
            <div class="field">
              <label for="initial">Initial investment ($)</label>
              <input id="initial" type="number" min="0" step="100" value="5000" />
              <div class="hint">One-time starting amount.</div>
            </div>

            <div class="field">
              <label for="monthly">Monthly contribution ($)</label>
              <input id="monthly" type="number" min="0" step="25" value="300" />
              <div class="hint">Added each month.</div>
            </div>

            <div class="field">
              <label for="contribGrow">Contribution growth (% / yr)</label>
              <input id="contribGrow" type="number" min="0" step="0.1" value="2.0" />
              <div class="hint">Auto-increase contributions yearly.</div>
            </div>

            <div class="field">
              <label for="years">Time horizon (years)</label>
              <input id="years" type="number" min="1" max="60" step="1" value="20" />
              <div class="hint">1–60 years.</div>
            </div>

            <div class="field">
              <label for="returnRate">Annual return (%)</label>
              <input id="returnRate" type="number" step="0.1" value="7.0" />
              <div class="hint">Nominal (before inflation).</div>
            </div>

            <div class="field">
              <label for="compound">Compounding</label>
              <select id="compound">
                <option value="12" selected>Monthly</option>
                <option value="4">Quarterly</option>
                <option value="1">Annually</option>
              </select>
              <div class="hint">How often interest is applied.</div>
            </div>

            <div class="field">
              <label for="inflation">Inflation (% / yr)</label>
              <input id="inflation" type="number" step="0.1" value="2.5" />
              <div class="hint">Used for real (today’s $) estimate.</div>
            </div>

            <div class="field">
              <label for="tax">Tax on gains (%)</label>
              <input id="tax" type="number" min="0" max="60" step="0.1" value="15.0" />
              <div class="hint">Simplified end-of-horizon tax.</div>
            </div>

            <div class="field full">
              <label for="target">Target amount ($)</label>
              <input id="target" type="number" min="0" step="1000" placeholder="e.g. 1000000" />
              <div class="hint">Optional: see when you reach it + required monthly contribution.</div>
            </div>

            <div class="field full">
              <div class="actions">
                <button class="btn primary" id="calcBtn" type="button">Calculate</button>
                <button class="btn" id="resetBtn" type="button">Reset</button>
                <button class="btn" id="excelBtn" type="button">Export to Excel</button>
                <button class="btn" id="pdfBtn" type="button">Export to PDF</button>
                <div class="note"><span class="pill">Tip</span> Try 30 yrs + 8% return</div>
              </div>
              <div class="warn" id="warn"></div>
              <div class="footerHelp">
                Month-by-month simulation. Taxes applied once at the end on <span class="pill">max(0, final − total contributed)</span>.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- OUTPUTS -->
      <section class="panel">
        <div class="hd">
          <div class="k">
            <div class="t">Outputs</div>
            <div class="d">KPIs, growth chart, yearly breakdown, and target planning.</div>
          </div>
          <div class="small" id="stamp">—</div>
        </div>

        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <div class="l">Final portfolio (nominal)</div>
              <div class="v" id="kpiFinal">$—</div>
              <div class="s">After end-of-horizon taxes</div>
            </div>
            <div class="kpi">
              <div class="l">Total invested</div>
              <div class="v" id="kpiInvested">$—</div>
              <div class="s">Initial + all contributions</div>
            </div>
            <div class="kpi">
              <div class="l">Interest earned</div>
              <div class="v" id="kpiInterest">$—</div>
              <div class="s">Before taxes</div>
            </div>
            <div class="kpi">
              <div class="l">Real value (today’s $)</div>
              <div class="v" id="kpiReal">$—</div>
              <div class="s">Inflation-adjusted estimate</div>
            </div>
          </div>

          <div class="kpis" style="margin-top:12px">
            <div class="kpi">
              <div class="l">Target status</div>
              <div class="v" id="kpiTargetStatus">—</div>
              <div class="s">Based on your target amount</div>
            </div>
            <div class="kpi">
              <div class="l">Time to target</div>
              <div class="v" id="kpiTargetTime">—</div>
              <div class="s">If reachable within horizon</div>
            </div>
            <div class="kpi">
              <div class="l">Required monthly (to hit target)</div>
              <div class="v" id="kpiReqMonthly">—</div>
              <div class="s">Solves for monthly contribution</div>
            </div>
            <div class="kpi">
              <div class="l">Notes</div>
              <div class="v" style="font-size:14px;font-weight:700" id="kpiNotes">—</div>
              <div class="s">Helpful interpretation</div>
            </div>
          </div>

          <div class="chartWrap">
            <div class="chartTop">
              <div class="legend">
                <div class="key"><span class="sw"></span> Total portfolio</div>
                <div class="key"><span class="sw b"></span> Total contributed</div>
              </div>
              <div class="small" id="chartNote">—</div>
            </div>
            <canvas id="chart" width="900" height="300" aria-label="Growth chart" role="img"></canvas>
          </div>

          <div class="tableWrap" style="max-height:340px; overflow:auto;">
            <table>
              <thead>
                <tr>
                  <th>Year</th>
                  <th class="right">End balance</th>
                  <th class="right">Total contributed</th>
                  <th class="right">Interest earned</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const el = {
    initial:$('initial'), monthly:$('monthly'), contribGrow:$('contribGrow'), years:$('years'),
    returnRate:$('returnRate'), compound:$('compound'), inflation:$('inflation'), tax:$('tax'),
    target:$('target'),
    calcBtn:$('calcBtn'), resetBtn:$('resetBtn'), excelBtn:$('excelBtn'), pdfBtn:$('pdfBtn'),
    warn:$('warn'), stamp:$('stamp'), chart:$('chart'), chartNote:$('chartNote'),
    kpiFinal:$('kpiFinal'), kpiInvested:$('kpiInvested'), kpiInterest:$('kpiInterest'), kpiReal:$('kpiReal'),
    kpiTargetStatus:$('kpiTargetStatus'), kpiTargetTime:$('kpiTargetTime'),
    kpiReqMonthly:$('kpiReqMonthly'), kpiNotes:$('kpiNotes'),
    tbody:$('tbody')
  };

  function fmtMoney(n, digits=0){
    if(!isFinite(n)) return '—';
    return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:digits});
  }
  function fmtPct(n){ return (n).toFixed(2) + '%'; }

  function showWarn(msg){
    el.warn.style.display = msg ? 'block' : 'none';
    el.warn.textContent = msg || '';
  }

  // --- Simulation (month-by-month) ---
  function simulate(p){
    const months = p.years * 12;
    const rAnnual = p.annualReturn / 100;
    const inflAnnual = p.inflation / 100;
    const growAnnual = p.contribGrow / 100;

    const cpy = p.compoundsPerYear;
    const pRate = Math.pow(1 + rAnnual, 1 / cpy) - 1;
    const monthsPerPeriod = 12 / cpy;

    let balance = p.initial;
    let contributed = p.initial;

    const seriesTotal = [];
    const seriesContrib = [];
    const yearly = [];

    let monthlyContribution = p.monthly;

    for(let m=1; m<=months; m++){
      // contribution at start of month
      balance += monthlyContribution;
      contributed += monthlyContribution;

      // interest at end of compounding period
      if(m % monthsPerPeriod === 0){
        balance *= (1 + pRate);
      }

      seriesTotal.push(balance);
      seriesContrib.push(contributed);

      if(m % 12 === 0){
        const year = m/12;
        const interestEarned = Math.max(0, balance - contributed);
        yearly.push({ year, endBalance: balance, contributed, interestEarned });
        monthlyContribution *= (1 + growAnnual);
      }
    }

    const gains = Math.max(0, balance - contributed);
    const taxPaid = gains * (p.tax / 100);
    const afterTax = balance - taxPaid;
    const real = afterTax / Math.pow(1 + inflAnnual, p.years);

    // when do we reach target (based on after-tax at that month? taxes are end-only, so use pre-tax path)
    let targetMonth = null;
    if(p.target && p.target > 0){
      for(let i=0; i<seriesTotal.length; i++){
        if(seriesTotal[i] >= p.target){ targetMonth = i+1; break; }
      }
    }

    return { afterTax, beforeTax: balance, contributed, gains, taxPaid, real, yearly, seriesTotal, seriesContrib, targetMonth };
  }

  // --- Solver: required monthly contribution to hit target within horizon ---
  // Uses binary search over monthly amount, keeping contribution growth as configured.
  function requiredMonthlyToHitTarget(baseParams){
    if(!(baseParams.target > 0)) return null;

    // If already hit with $0 monthly, return 0
    const p0 = {...baseParams, monthly: 0};
    if(simulate(p0).beforeTax >= baseParams.target) return 0;

    // Upper bound search
    let lo = 0;
    let hi = Math.max(50, baseParams.monthly || 300);
    let tries = 0;

    while(tries < 30){
      const test = simulate({...baseParams, monthly: hi});
      if(test.beforeTax >= baseParams.target) break;
      hi *= 2;
      if(hi > 1_000_000) return null; // unrealistic / unreachable
      tries++;
    }

    // Binary search
    for(let i=0; i<40; i++){
      const mid = (lo + hi) / 2;
      const test = simulate({...baseParams, monthly: mid});
      if(test.beforeTax >= baseParams.target) hi = mid;
      else lo = mid;
    }

    return hi;
  }

  // --- Simple Canvas chart (no external libs) ---
  function formatCompact(v){
    if(!isFinite(v)) return '—';
    const abs = Math.abs(v);
    if(abs >= 1e9) return (v/1e9).toFixed(1)+'B';
    if(abs >= 1e6) return (v/1e6).toFixed(1)+'M';
    if(abs >= 1e3) return (v/1e3).toFixed(0)+'K';
    return Math.round(v).toString();
  }

  function drawChart(canvas, total, contrib){
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    ctx.clearRect(0,0,W,H);

    const padL=54, padR=16, padT=16, padB=32;
    const iw = W - padL - padR;
    const ih = H - padT - padB;

    const maxY = Math.max(...total, ...contrib, 1);
    const n = total.length;
    if(n < 2) return;

    const x = (i)=> padL + (i/(n-1))*iw;
    const y = (v)=> padT + (1 - (v/maxY))*ih;

    // grid
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1;
    const gridLines = 4;
    for(let g=0; g<=gridLines; g++){
      const yy = padT + (g/gridLines)*ih;
      ctx.beginPath(); ctx.moveTo(padL, yy); ctx.lineTo(padL+iw, yy); ctx.stroke();
    }

    // y labels
    ctx.fillStyle = 'rgba(169,179,207,0.9)';
    ctx.font = '12px ui-monospace, Menlo, Consolas, monospace';
    ctx.textAlign='right'; ctx.textBaseline='middle';
    for(let g=0; g<=gridLines; g++){
      const yy = padT + (g/gridLines)*ih;
      const val = (1 - g/gridLines)*maxY;
      ctx.fillText(formatCompact(val), padL-10, yy);
    }

    // x labels
    ctx.textAlign='center'; ctx.textBaseline='top';
    ctx.font = '11px ui-monospace, Menlo, Consolas, monospace';
    for(let m=0; m<n; m+=12){
      ctx.fillText('Y' + (Math.floor(m/12)+1), x(m), padT+ih+8);
    }

    function areaLine(series, stroke, fill){
      ctx.beginPath();
      for(let i=0;i<n;i++){
        const xx=x(i), yy=y(series[i]);
        if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      }
      ctx.lineTo(padL+iw, padT+ih);
      ctx.lineTo(padL, padT+ih);
      ctx.closePath();
      ctx.fillStyle = fill; ctx.fill();

      ctx.beginPath();
      for(let i=0;i<n;i++){
        const xx=x(i), yy=y(series[i]);
        if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      }
      ctx.strokeStyle = stroke; ctx.lineWidth = 2; ctx.stroke();
    }

    areaLine(contrib, 'rgba(121,255,215,0.85)', 'rgba(121,255,215,0.10)');
    areaLine(total,  'rgba(106,167,255,0.95)', 'rgba(106,167,255,0.12)');

    ctx.strokeStyle = 'rgba(255,255,255,0.10)';
    ctx.lineWidth = 1;
    ctx.strokeRect(padL, padT, iw, ih);
  }

  function readInputs(){
    const initial = Number(el.initial.value);
    const monthly = Number(el.monthly.value);
    const contribGrow = Number(el.contribGrow.value);
    const years = Number(el.years.value);
    const annualReturn = Number(el.returnRate.value);
    const compoundsPerYear = Number(el.compound.value);
    const inflation = Number(el.inflation.value);
    const tax = Number(el.tax.value);
    const target = Number(el.target.value);

    if(!isFinite(initial) || initial < 0) return {error:"Initial investment must be 0 or more."};
    if(!isFinite(monthly) || monthly < 0) return {error:"Monthly contribution must be 0 or more."};
    if(!isFinite(contribGrow) || contribGrow < 0) return {error:"Contribution growth must be 0 or more."};
    if(!isFinite(years) || years < 1 || years > 60) return {error:"Years must be between 1 and 60."};
    if(!isFinite(annualReturn) || annualReturn < -50 || annualReturn > 50) return {error:"Annual return looks unrealistic. Use -50% to 50%."};
    if(!isFinite(inflation) || inflation < 0 || inflation > 20) return {error:"Inflation should be between 0% and 20%."};
    if(!isFinite(tax) || tax < 0 || tax > 60) return {error:"Tax should be between 0% and 60%."};
    if(!isFinite(target) || target < 0) return {error:"Target must be 0 or more (or leave blank)."};
    return { initial, monthly, contribGrow, years, annualReturn, compoundsPerYear, inflation, tax, target };
  }

  function render(res, p){
    // KPIs
    el.kpiFinal.textContent = fmtMoney(res.afterTax);
    el.kpiInvested.textContent = fmtMoney(res.contributed);
    el.kpiInterest.textContent = fmtMoney(Math.max(0, res.beforeTax - res.contributed));
    el.kpiReal.textContent = fmtMoney(res.real);

    // stamps
    const now = new Date();
    el.stamp.textContent = now.toLocaleString(undefined,{dateStyle:'medium', timeStyle:'short'});
    el.chartNote.textContent = `${p.years} years • ${fmtPct(p.annualReturn)} return • ${p.compoundsPerYear===12?'monthly':p.compoundsPerYear===4?'quarterly':'annual'} compounding`;

    // Table
    el.tbody.innerHTML = '';
    const frag = document.createDocumentFragment();
    res.yearly.forEach(row=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.year}</td>
        <td class="right">${fmtMoney(row.endBalance)}</td>
        <td class="right">${fmtMoney(row.contributed)}</td>
        <td class="right">${fmtMoney(row.interestEarned)}</td>
      `;
      frag.appendChild(tr);
    });
    el.tbody.appendChild(frag);

    // Chart
    drawChart(el.chart, res.seriesTotal, res.seriesContrib);

    // Target & solver
    if(p.target && p.target > 0){
      const finalPreTax = res.beforeTax;
      const hit = finalPreTax >= p.target;

      el.kpiTargetStatus.textContent = hit ? "On track ✅" : "Not reached ❌";
      if(res.targetMonth){
        const y = (res.targetMonth/12);
        el.kpiTargetTime.textContent = `${y.toFixed(1)} yrs`;
      } else {
        el.kpiTargetTime.textContent = "—";
      }

      const reqMonthly = requiredMonthlyToHitTarget(p);
      if(reqMonthly === null){
        el.kpiReqMonthly.textContent = "—";
        el.kpiNotes.textContent = "Target may be unrealistic with current return/timeline.";
      } else {
        el.kpiReqMonthly.textContent = fmtMoney(reqMonthly, 0);
        if(hit){
          el.kpiNotes.textContent = "You already reach the target with current inputs.";
        } else {
          el.kpiNotes.textContent = "Increase monthly contribution or extend timeline.";
        }
      }
    } else {
      el.kpiTargetStatus.textContent = "Add a target";
      el.kpiTargetTime.textContent = "—";
      el.kpiReqMonthly.textContent = "—";
      el.kpiNotes.textContent = "Enter a target amount to unlock goal planning.";
    }

    // Store for export
    window.__lastRun = {p, res};
  }

  function calculate(){
    showWarn('');
    const p = readInputs();
    if(p.error){ showWarn(p.error); return; }
    const res = simulate(p);
    render(res, p);
  }

  function reset(){
    el.initial.value = 5000;
    el.monthly.value = 300;
    el.contribGrow.value = 2.0;
    el.years.value = 20;
    el.returnRate.value = 7.0;
    el.compound.value = 12;
    el.inflation.value = 2.5;
    el.tax.value = 15.0;
    el.target.value = '';
    calculate();
  }

  // Export to Excel (CSV that opens in Excel)
  function exportExcel(){
    if(!window.__lastRun) calculate();
    const r = window.__lastRun.res;
    const p = window.__lastRun.p;

    const meta = [
      ["Bushra Hoq — Investment Calculator Export"],
      ["Generated", new Date().toLocaleString()],
      ["Initial", p.initial],
      ["Monthly", p.monthly],
      ["Contribution Growth %/yr", p.contribGrow],
      ["Years", p.years],
      ["Annual Return %", p.annualReturn],
      ["Compounding per year", p.compoundsPerYear],
      ["Inflation %/yr", p.inflation],
      ["Tax on gains %", p.tax],
      ["Target", p.target || ""],
      [],
      ["Year","EndBalance","TotalContributed","InterestEarned"]
    ];

    const rows = meta.concat(
      r.yearly.map(y=>[y.year, Math.round(y.endBalance), Math.round(y.contributed), Math.round(y.interestEarned)])
    );

    const csv = rows.map(a => a.map(x=>{
      const s = String(x ?? "");
      // quote if commas/newlines
      return /[,\n"]/g.test(s) ? '"' + s.replace(/"/g,'""') + '"' : s;
    }).join(",")).join("\n");

    const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'investment_calculator_export.csv';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // Export to PDF (print to PDF)
  function exportPDF(){ window.print(); }

  // Bind
  el.calcBtn.addEventListener('click', calculate);
  el.resetBtn.addEventListener('click', reset);
  el.excelBtn.addEventListener('click', exportExcel);
  el.pdfBtn.addEventListener('click', exportPDF);

  el.compound.addEventListener('change', calculate);
  ['initial','monthly','contribGrow','years','returnRate','inflation','tax','target'].forEach(id=>{
    $(id).addEventListener('keydown', (e)=>{ if(e.key==='Enter') calculate(); });
    $(id).addEventListener('change', ()=>calculate());
  });

  // initial run
  calculate();
})();
</script>
</body>
</html>
